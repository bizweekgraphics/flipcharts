<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">

  <link href="favicon.ico" rel="shortcut icon" type="image/vnd.microsoft.icon" />
  <link href="apple-touch-icon-precomposed.png" rel="apple-touch-icon" type="image/png" />

  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/h5bp.css">
  <link rel="stylesheet" href="css/bbw.css">
  <link rel="stylesheet" href="css/charts.css">
  <script src="js/vendor/modernizr-2.6.2.min.js"></script>
  <script type="text/javascript" src="js/vendor/iscroll.js"></script>
</head>

<script type="text/javascript">

var myScroll;

function loaded () {
  myScroll = new IScroll('#wrapper', {
    scrollX: true,
    scrollY: false,
    momentum: false,
    snap: true,
    snapSpeed: 400,
    keyBindings: true,
    indicators: {
      el: document.getElementById('indicator'),
      resize: false
    }
  });
}

document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
</script>

<style type="text/css">
* {
  -webkit-box-sizing: border-box;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

html {
  -ms-touch-action: none;
  width: 100%;
  height: 100%;
}

body, ul, li {
  padding: 0;
  margin: 0;
  border: 0;
}

body {
  font-size: 12px;
  font-family: ubuntu, helvetica, arial;
  overflow: hidden; /* this is important to prevent the whole page to bounce */
  width: 100%;
  height: 100%;
  background: url(img/scribble_light.png);
}

#viewport {
  position: relative;
  width: 100%;
  height: 100%;
  margin: 0 auto;
  overflow: hidden;
}

#wrapper {
  width: 100%;
  height: 100%;
  margin: 0 auto;
}

#scroller {
  position: absolute;
  z-index: 1;
  -webkit-tap-highlight-color: rgba(0,0,0,0);
  width: 500%;
  height: 100%;
  -webkit-transform: translateZ(0);
  -moz-transform: translateZ(0);
  -ms-transform: translateZ(0);
  -o-transform: translateZ(0);
  transform: translateZ(0);
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-text-size-adjust: none;
  -moz-text-size-adjust: none;
  -ms-text-size-adjust: none;
  -o-text-size-adjust: none;
  text-size-adjust: none;
}

.slide {
  width: 20%;
  height: 100%;
  float: left;
  font-family: BWHaasRegular;
  text-align: left;
  font-size: 13pt;
  position: relative;
  text-shadow: #fff 1px 1px 0px;
}

.slide-inner {
  width: 100%;
  height: 100%;
  padding: 20px;
}

.slide svg {
  position: absolute;
  top:0;
  left:0;
  z-index: -1;
}

.axis line, .axis path {
  fill: none;
  stroke: none;
}

.y.axis .tick line {
  stroke: #eee;
}

.y.axis {
  font-size: 10pt;
}

h2 {
  font-family: BWHaasHead;
  font-size: 20pt;
  margin-right: 20px;
}

#title {
  margin: 0;
}

.preview {
  text-align: center;
}

#indicator {
  position: absolute;
  z-index: 1;
  bottom: 0px;
  width: 100%;
  height: 5px;
}

#dotty {
  position: absolute;
  width: 20%;
  height: 5px;
  background: #666;
}

table {
  width: 100%;
}

table thead {
  font-family: BWHaasHead;
}

table tr {
  border-bottom: 1px solid black;
}

table td {
  padding: 10px;
}

table .num {
  text-align: right;
}

/* from pure css http://purecss.io/buttons/ */
button {
  font-family: BWHaasHead;
  font-size: 100%;
  padding: .5em 1.5em;
  color: #444;
  color: rgba(0,0,0,.8);
  border: 1px solid #999;
  border: 0 rgba(0,0,0,0);
  background-color: #E6E6E6;
  text-decoration: none;
  border-radius: 2px;
  -webkit-transition: .1s linear -webkit-box-shadow;
  -moz-transition: .1s linear -moz-box-shadow;
  -ms-transition: .1s linear box-shadow;
  -o-transition: .1s linear box-shadow;
  transition: .1s linear box-shadow;
  display: inline-block;
  zoom: 1;
  line-height: normal;
  white-space: nowrap;
  vertical-align: baseline;
  text-align: center;
  cursor: pointer;
  -webkit-user-drag: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  -webkit-appearance: button;
  cursor: pointer;
  margin: 0;
  box-sizing: border-box;
  align-items: flex-start;
}

button:hover {
  background-image: linear-gradient(transparent,rgba(0,0,0,.05) 40%,rgba(0,0,0,.1));
}

.up-for-more {
  position: absolute;
  top: 0;
  right: 2px;
  -webkit-transform: rotate(180deg);
  cursor: pointer;
  z-index: 9;
}

@media (min-width: 640px) {
  /* desktop view */

  #viewport {
    width: 100%;
    height: 480px;
    background: none;
    top: 20%;
  }

  #wrapper {
    width: 320px;
    height: 100%;
    background: none;
  }

  #scroller {
    width: 1600px;
    height: 100%;
  }

}

/* thx http://jsfiddle.net/mandynicole/7xrKP/ */
.pulser {
    border: 3px solid #999;
    -webkit-border-radius: 30px;
    height: 35px;
    width: 35px;
    position: absolute;
    -webkit-animation: pulsate 1s ease-out;
    -webkit-animation-iteration-count: infinite;
    opacity: 0.0
}
@-webkit-keyframes pulsate {
    0% {-webkit-transform: scale(0.1, 0.1); opacity: 0.0;}
    50% {opacity: 1.0;}
    100% {-webkit-transform: scale(1.2, 1.2); opacity: 0.0;}
}

</style>

<!--
Body classes:
.iframed    // no interface wrapping, no margins
.dark_layout  // like bbw video site
.half      // half-width of standard article (315px)
.full      // full-width of standard article (630px)
.wide      // wide interactive feature layout (970px)

Fonts:
font-family:BloombergLBold    // corporate wordmark logotype
font-family:BWHaasHead
font-family:BWHaasHead75Bold
font-family:BWHaasRegular
-->

<body onload="loaded()">

  <div id="viewport">
    <div id="wrapper">
      <div id="scroller">
        <div class="slide" id="slide1">
          <div class="slide-inner">
            <h2>Oils spills from tankers are down</h3>
            <p>(gallons spilled from tankers, U.S.)</p>
          </div>
        </div>
        <div class="slide" id="slide2">
          <div class="slide-inner">
            <h2>for three reasons</h3>
            <p>1. Better regulation</p>
            <p>2. Better engineering</p>
            <p>3. Better maps</p>
          </div>
        </div>
        <div class="slide" id="slide3">
          <div class="slide-inner">
            <h2>but other sources have picked up the slack</h3>
            <p>(gallons spilled from all sources, U.S.)</p>
              <div class="up-for-more">
                  <img src="img/down.png" width="40">
                  <div class="pulser" style="right:3px;top:2px;z-index:-1;"></div>
              </div>
          </div>
        </div>
        <div class="slide" id="slide4">
          <div class="slide-inner">
            <h2>In 2012, most spills were from industrial dumping</h3>
            <table>
              <thead><tr><td></td><td class="num">1989</td><td class="num">2012</td></tr></thead>
              <tbody>
              <tr><td>Ships</td><td class="num">89%</td><td class="num">14%</td></tr>
              <tr><td>Facilities</td><td class="num">3%</td><td class="num">21%</td></tr>
              <tr><td>Pipelines</td><td class="num">2%</td><td class="num">&lt;1%</td></tr>
              <tr><td>Other <br/><em>(incl. dumping)</em></td><td class="num">6%</td><td class="num">64%</td></tr>
            </tbody>
            </table>
          </div>
        </div>
        <div class="slide" id="slide5">
          <div class="slide-inner preview">
            <a href="http://businessweek.com/" title="Bloomberg Businessweek"><img src="apple-touch-icon-precomposed.png" width="50"></a>
            <h2 id="title">Oil spill title</h2>
            <p id="description">This is dek, different from the dek you are at now. I am typing the sound of my dek and I repeating and repeating the dek dek dek TK sound of my speaking voice.</p>
            <a id="story-link" href="#"><button>Read article</button></a>
            <div class="data-credit">Data: compiled by Bloomberg</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div id="indicator">
    <div id="dotty"></div>
  </div>

  <!--
  <svg id="svg-canvas" class="fullscreen">
    <defs>
      <marker id = "arrowhead" viewBox = "-10 -10 20 20" refX = "0" refY = "0" markerWidth = "20" markerHeight = "20" stroke-width = "1" orient = "auto">
        <polyline class="arrow" stroke-linejoin="bevel" points="-6.72,-6.749 0.54,0 -6.72,6.749 "/>
      </marker>
    </defs>
  </svg>
  -->

  <script src="js/vendor/d3.min.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="js/vendor/jquery-1.10.2.min.js"><\/script>')</script>
  <script src="js/plugins.js"></script>
  <script src="js/main.js"></script>
  <script src="js/charts.js"></script>

  <script>

// LOAD DATA FROM ALL SOURCES
var dataSources = [
  { name: "Total spills", src: "totalspills.tsv" },
  { name: "Tanker spills", src: "tankerspills.tsv" }
  ]

// files remaining
var activeAJAX = dataSources.length;

var data = new Object();

dataSources.forEach(function(dataSource, i) {
  if(dataSource.src) {
    d3.tsv("data/"+dataSource.src, function(error, dataLoaded) {
      //coercing from strings to numbers
      dataLoaded.forEach(function(d, i) {
        $.each(d, function(j, value) {
          //dataLoaded[i][j] = +value;
        })
      });
      data[dataSource.name] = dataLoaded;
      // if all files have been loaded...
      if (--activeAJAX == 0) {
        render();
        slides = d3.selectAll(".slide");
      }
    });
  } else { render(); }
});

//////////////////////////////////////////////////////////////////////////////////////////
// RENDER ////////////////////////////////////////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////////////////////////

function render() {
  var tankerBarChart = barChart()
      .x(function(d) { return d.year; })
      .y(function(d) { return +d.value; })
      .width($("#slide1").width())
      .height($("#slide1").height());
  d3.select("#slide1").datum(data["Tanker spills"]).call(tankerBarChart);

  var totalBarChart = barChart()
      .x(function(d) { return d.year; })
      .y(function(d) { return +d.value; })
      .width($("#slide3").width())
      .height($("#slide3").height())
      .yDomain([0,2e7]);
  d3.select("#slide3").datum(data["Total spills"]).call(totalBarChart);
  d3.select('[data-annotation="Deepwater Horizon"] text')
    .attr("transform", "rotate(-20)")
    .attr("dx","-30")
    .attr("dy","-10");
  drawArrow(d3.select('#slide3 .chart.bar [data-x="2010"]'), [-5,40], [-50,10], 90, true);

  d3.select(".up-for-more").on("click",showDeepwater);
  d3.select(".up-for-more").on("touchstart",showDeepwater);

  function showDeepwater() {
      totalBarChart.yDomain("auto");
      d3.select("#slide3")
          .datum(data["Total spills"])
          .transition().duration(1000)
          .call(totalBarChart);
      d3.select(".up-for-more").remove();
  }

}

  </script>

</body>
</html>
